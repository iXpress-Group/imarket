{"ast":null,"code":"// Copyright 2010-2012 Mikeal Rogers\n//\n//    Licensed under the Apache License, Version 2.0 (the \"License\");\n//    you may not use this file except in compliance with the License.\n//    You may obtain a copy of the License at\n//\n//        http://www.apache.org/licenses/LICENSE-2.0\n//\n//    Unless required by applicable law or agreed to in writing, software\n//    distributed under the License is distributed on an \"AS IS\" BASIS,\n//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n//    See the License for the specific language governing permissions and\n//    limitations under the License.\nvar cookies = require('./lib/cookies'),\n    copy = require('./lib/copy'),\n    Request = require('./request'); // organize params for patch, post, put, head, del\n\n\nfunction initParams(uri, options, callback) {\n  if (typeof options === 'function' && !callback) callback = options;\n\n  if (options && typeof options === 'object') {\n    options.uri = uri;\n  } else if (typeof uri === 'string') {\n    options = {\n      uri: uri\n    };\n  } else {\n    options = uri;\n    uri = options.uri;\n  }\n\n  return {\n    uri: uri,\n    options: options,\n    callback: callback\n  };\n}\n\nfunction request(uri, options, callback) {\n  if (typeof uri === 'undefined') throw new Error('undefined is not a valid uri or options object.');\n  if (typeof options === 'function' && !callback) callback = options;\n\n  if (options && typeof options === 'object') {\n    options.uri = uri;\n  } else if (typeof uri === 'string') {\n    options = {\n      uri: uri\n    };\n  } else {\n    options = uri;\n  }\n\n  options = copy(options);\n  if (callback) options.callback = callback;\n  var r = new Request(options);\n  return r;\n}\n\nmodule.exports = request;\nrequest.Request = Request;\nrequest.debug = process.env.NODE_DEBUG && /request/.test(process.env.NODE_DEBUG);\nrequest.initParams = initParams;\n\nrequest.defaults = function (options, requester) {\n  var def = function (method) {\n    var d = function (uri, opts, callback) {\n      var params = initParams(uri, opts, callback);\n\n      for (var i in options) {\n        if (params.options[i] === undefined) params.options[i] = options[i];\n      }\n\n      if (typeof requester === 'function') {\n        if (method === request) {\n          method = requester;\n        } else {\n          params.options._requester = requester;\n        }\n      }\n\n      return method(params.options, params.callback);\n    };\n\n    return d;\n  };\n\n  var de = def(request);\n  de.get = def(request.get);\n  de.patch = def(request.patch);\n  de.post = def(request.post);\n  de.put = def(request.put);\n  de.head = def(request.head);\n  de.del = def(request.del);\n  de.cookie = def(request.cookie);\n  de.jar = request.jar;\n  return de;\n};\n\nfunction requester(params) {\n  if (typeof params.options._requester === 'function') {\n    return params.options._requester;\n  } else {\n    return request;\n  }\n}\n\nrequest.forever = function (agentOptions, optionsArg) {\n  var options = {};\n\n  if (optionsArg) {\n    for (var option in optionsArg) {\n      options[option] = optionsArg[option];\n    }\n  }\n\n  if (agentOptions) options.agentOptions = agentOptions;\n  options.forever = true;\n  return request.defaults(options);\n};\n\nrequest.get = request;\n\nrequest.post = function (uri, options, callback) {\n  var params = initParams(uri, options, callback);\n  params.options.method = 'POST';\n  return requester(params)(params.uri || null, params.options, params.callback);\n};\n\nrequest.put = function (uri, options, callback) {\n  var params = initParams(uri, options, callback);\n  params.options.method = 'PUT';\n  return requester(params)(params.uri || null, params.options, params.callback);\n};\n\nrequest.patch = function (uri, options, callback) {\n  var params = initParams(uri, options, callback);\n  params.options.method = 'PATCH';\n  return requester(params)(params.uri || null, params.options, params.callback);\n};\n\nrequest.head = function (uri, options, callback) {\n  var params = initParams(uri, options, callback);\n  params.options.method = 'HEAD';\n\n  if (params.options.body || params.options.requestBodyStream || params.options.json && typeof params.options.json !== 'boolean' || params.options.multipart) {\n    throw new Error(\"HTTP HEAD requests MUST NOT include a request body.\");\n  }\n\n  return requester(params)(params.uri || null, params.options, params.callback);\n};\n\nrequest.del = function (uri, options, callback) {\n  var params = initParams(uri, options, callback);\n  params.options.method = 'DELETE';\n  return requester(params)(params.uri || null, params.options, params.callback);\n};\n\nrequest.jar = function () {\n  return cookies.jar();\n};\n\nrequest.cookie = function (str) {\n  return cookies.parse(str);\n};","map":null,"metadata":{},"sourceType":"script"}